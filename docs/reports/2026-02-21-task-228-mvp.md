# Task #228 — ZeroBitch Fleet MVP funcional (API + UI live)

## What changed

Implemented and validated a functional MVP with live API/UI behavior over Docker-discovered ZeroClaw containers.

### Core fixes shipped

1. **Dashboard stability + live refresh hardening (UI)**
   - Added safe handling for missing/partial metrics payloads.
   - Added fetch error handling for metrics/agents/refresh calls.
   - Added `refreshInFlight` guard to prevent overlapping refresh races.

2. **Docker adapter now enforces real fleet inventory**
   - After Docker refresh, DB now keeps only currently discovered `zeroclaw-*` agents.
   - Removed seeded/demo leakage from docker mode so dashboard reflects only real container state.

3. **Logs tail endpoint robustness**
   - `GET /api/agents/{id}/logs` now always returns numeric timestamps (`ts`) even when Docker timestamp parsing fails.
   - Improved RFC3339 parsing to tolerate fractional timestamp variants.

## Files touched

- `zerobitch_fleet/static/app.js`
- `zerobitch_fleet/adapters/docker/adapter.py`
- `zerobitch_fleet/core/db.py`

## Validation / smoke tests run (real output)

```text
== VALIDATION 2026-02-21 ==
py_compile: OK
compose_up: OK
-- health --
{"status":"ok","ts":1771683589}

-- refresh --
{"adapter":"docker","message":"docker inventory refreshed","ok":true,"updated":10}

-- metrics --
{"adapter":"docker","counts":{"error":0,"other":0,"running":10,"stopped":0,"total":10},"poll_interval_sec":15,"ram":{"limit_mb":1248.0,"used_mb":27.49},"ts":1771683609}

-- sample_agent=zeroclaw-builder-1 --
-- logs tail --
{"agent_id":"zeroclaw-builder-1","logs":[{"line":"  ⚠️  Pairing: DISABLED (all requests accepted)","ts":1771683609},{"line":"  Press Ctrl+C to stop.","ts":1771683609},{"line":"2026-02-20T10:26:28.181831815Z ","ts":1771683609}],"tail":3}

-- mock task dispatch --
{"message":"mock task accepted (no container mutation)","ok":true}
```

Additional check:

```text
TOTAL 10
NON_ZER0 []
FIRST ['zeroclaw-builder-1', 'zeroclaw-builder-2', 'zeroclaw-janitor', 'zeroclaw-mei-ling', 'zeroclaw-metrics']
```

## Deliverable mapping

- Deployable by docker compose ✅
- Real API endpoints (no placeholders) ✅
- Active dashboard UI ✅
- Real ZeroClaw container status ✅
- Tail logs per agent ✅
- Mock dispatch endpoint wired end-to-end ✅
- OpenClaw install/setup instructions ✅ (`README.md`, `scripts/install-on-openclaw.sh`)

## Risks / follow-ups

- Flask dev server is used in container (`python -m zerobitch_fleet`). For production hardening, switch to Gunicorn/Uvicorn + reverse proxy.
- Docker logs stream includes some non-uniform line framing depending on container log format; endpoint is robust but can be improved with stream demux parsing.

Follow-up flag: **YES**
Recommended action: move runtime to Gunicorn and add optional auth/API key for control-plane endpoints.
